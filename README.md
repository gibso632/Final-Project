{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "03fd18db-4c44-4d66-a2e8-0f5247b941d4",
   "metadata": {},
   "source": [
    "# Mount Graham Red Squirrel Individual-Based Model Set Up and Simulation\n",
    "\n",
    "## Notebooks\n",
    "\n",
    "### Sky_Islands_Model\n",
    "\n",
    "Sets up a basic sky islands model using the provided precipitation, temperature, and NDVI rasters. This raster will be used in the following two notebooks as vector-based sky island extents primarily for quality control of American red squirrel data.\n",
    "\n",
    "Various raster processing functions are created to generate the model.\n",
    "- Functions with \"inRaster\" and \"outRaster\" have a single raster input and output. Example:\n",
    "'''python\n",
    "reprojectRaster('ndviFile.tif', 'ndviReproject.tif', 'epsg:4326') # Change to the personal input file and output file names\n",
    "'''\n",
    "- Functions with \"rastList\" or \"input_rasters\" input a list of rasters and output a single raster. Example:\n",
    "'''python\n",
    "mergeNDVI = mergeRasters(fileList,'mergeNDVI.tif') # Change to the personal input file list and output file name\n",
    "'''\n",
    "\n",
    "### Data_Preparation_for_IBM\n",
    "\n",
    "Provides QC of American red squirrel occurrence data and sets up Mount Graham red squirrel population for individual preference establishment and population intialization for the IBM simulation respectively. This is performed by clipping the occurence data by the entire sky islands model (removes inaccurate American red squirrel data) and clipping the sky islands model by a polygon with specific vertices ((-109.73,32.8),(-110.15,32.8),(-110.15,32.58),(-109.73,32.58)) to clip the occurrence data (creates the Mount Graham red squirrel occurrence data). This is done via converting the sky islands model to vector data. Example from notebook:\n",
    "\n",
    "'''python\n",
    "raster_to_shapefile(r\"C:\\Users\\ericg\\siRast.tif\", 'SI.shp', 27)\n",
    "\n",
    "pinalenoClip = Polygon([[-109.73,32.8],[-110.15,32.8],[-110.15,32.58],[-109.73,32.58]])\n",
    "\n",
    "pinaleno = gpd.clip(siGDF,pinalenoClip)\n",
    "\n",
    "pinaleno = pinaleno.dissolve()\n",
    "\n",
    "mt_graham_red_squirrel = gpd.clip(red_squirrel,pinaleno)\n",
    "'''\n",
    "\n",
    "This notebook also organizes the environmental raster data for use in the IBM. The clipRasters function is used to limit the size of the file to just the study area for saving memory. Example use of the clipRasters function from notebook:\n",
    "\n",
    "'''python\n",
    "clipRasters(\n",
    "    r'path\\to\\precipitation\\folder', \n",
    "    name_of_study_area, \n",
    "    'Precipitation',\n",
    "    'Rasters'\n",
    ")\n",
    "'''\n",
    "\n",
    "### Individual_Based_SI_Model\n",
    "\n",
    "This notebook sets up the individual preferences based on where the occurrence points are located on the environmental factor rasters - wherever a point is located, the value of that raster cell is extracted. These values provide a distribution which generates a Kernel Density Model and each point in the initialized population of the simulation is given a specific environmental preference (precipitation amount, temperature, and NDVI value) range they will move towards. The \"create_pref_raster_list\" is a simple organizing function that creates a list to be used when finding preferences. Example from the notebook with the \"r'C:\\Users\\ericg\\IBM_SI\\Rasters'\" parameter as the folder with all of the environmental factor rasters and the \"'tif'\" parameter as the file type to add into the output nested list:\n",
    "\n",
    "'''python\n",
    "create_pref_raster_list(r'C:\\Users\\ericg\\IBM_SI\\Rasters','tif') # \n",
    "\n",
    "The \"findPrefs\" function finds the preference distributions for the American red squirrel occurrence data. Example used in notebook with the \"red_squirrel\" parameter as the occurrence data, the \"rastList\" parameter as the list created via the \"create_pref_raster_list\" function, and the \"'Mount Graham Red Squirrel'\" parameter as simply the output title of the boxplots for visualization:\n",
    "\n",
    "'''python\n",
    "red_squirrel_listDict = findPrefs(red_squirrel,rastList,'Mount Graham Red Squirrel')\n",
    "'''\n",
    "\n",
    "One cell builds the entire IBM for the Mount Graham red squirrel using American red squirrel life history characteristics, wildfire history in the Pinale√±o Mountains, and climate change predictions. Everything in the setup is prepared for the simulation already, so no changes are needed here unless a completely different species is being monitored. \n",
    "\n",
    "________________________________________________________________________________________________________________________________________________________\n",
    "\n",
    "#### runSim Function Parameters\n",
    "\n",
    "runSim(\n",
    "    endYear,\n",
    "    speciesData,\n",
    "    birthRate,\n",
    "    avgBirths,\n",
    "    maxBirths,\n",
    "    avgLifespan,\n",
    "    speciesName,\n",
    "    maxAge,\n",
    "    infantMort,\n",
    "    proximity_exp,\n",
    "    precipRasters,\n",
    "    tempRasters,\n",
    "    ndviRasters,\n",
    "    tempKDEs, \n",
    "    precKDEs, \n",
    "    ndviKDEs,\n",
    "    lineGraph,\n",
    "    dataFolder,\n",
    "    graphFolder,\n",
    "    mapFolder\n",
    ")\n",
    "\n",
    "endYear = (int) Final year of model\n",
    "speciesData = Geodataframe of species occurrence data\n",
    "birthRate = (float) Percentages of females of the species which give birth every year\n",
    "avgBirths = (int) Mean litter size\n",
    "maxBirths = (int) Maximum litter size\n",
    "avgLifespan = (int) Mean age at which the species experiences death\n",
    "speciesName = (str) Name of the species (for creating plots)\n",
    "maxAge = (int) Maximum recorded age of the species\n",
    "infantMort = (float) Percentage of newborns which die within the first year\n",
    "proximity_exp = (float) This is a constant which determines death probability from competition (Set to -8 for the Mount Graham red squirrel)\n",
    "precipRasters = (list) List of precipitation rasters\n",
    "tempRasters = (list) List of temperature rasters\n",
    "ndviRasters = (list) List of NDVI rasters\n",
    "tempKDEs = (list) List of KernelDensity objects creaed from temperature preference distribution\n",
    "precKDEs = (list) List of KernelDensity objects creaed from precipitation preference distribution\n",
    "ndviKDEs = (list) List of KernelDensity objects creaed from NDVI preference distribution\n",
    "lineGraph = (str) File name of population size simulation graph\n",
    "dataFolder = (str) Folder where all of the yearly individual location and wildfire polygon GeoJSONs will be saved\n",
    "graphFolder = (str) Folder where the simulation population graph will be saved\n",
    "mapFolder = (str) Folder where the yearly simulation maps will be saved\n",
    "\n",
    "________________________________________________________________________________________________________________________________________________________\n",
    "\n",
    "Lastly a GIF can be created on the entire simulation run using the \"createGIF\" function. Example used in notebook with the \"r'Non-Climate Change Simulations\\Sim 0\\Maps'\" parameter as the folder with all of the images to used in the GIF, the \"r'Non-Climate Change Simulations\\Sim 0\\Simulation GIF Py.gif'\" parameter as the output GIF file, and the \"4\" parameter as the frames per second:\n",
    "\n",
    "'''python\n",
    "createGIF(r'Non-Climate Change Simulations\\Sim 0\\Maps',r'Non-Climate Change Simulations\\Sim 0\\Simulation GIF Py.gif',4)\n",
    "'''"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
